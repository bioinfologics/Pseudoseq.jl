<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Core concepts &amp; workflow · Pseudoseq.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="Pseudoseq.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Pseudoseq.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../puzzlemaker/concepts/">PuzzleMaker</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Sequencing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Core concepts &amp; workflow</a><ul class="internal"><li><a class="tocitem" href="#.-Create-a-pool-of-DNA-molecules-1"><span>1. Create a pool of DNA molecules</span></a></li><li><a class="tocitem" href="#.-Process-the-DNA-molecule-pool-1"><span>2. Process the DNA molecule pool</span></a></li><li><a class="tocitem" href="#.-Generating-reads-1"><span>3. Generating reads</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/pe-example/">Paired end reads</a></li><li><a class="tocitem" href="../examples/se-example/">Long single end reads</a></li><li><a class="tocitem" href="../examples/tg-example/">Tagged paired end reads</a></li></ul></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Sequencing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/sequence/">sequence</a></li><li><a class="tocitem" href="../../../api/pool/">Molecule Pool</a></li><li><a class="tocitem" href="../../../api/reads/">Reads</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Sequencing</a></li><li class="is-active"><a href>Core concepts &amp; workflow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Core concepts &amp; workflow</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bioinfologics/Pseudoseq.jl/blob/master/docs/src/man/sequencing/concepts.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Sequencing:-*Core-concepts-and-basic-workflow*-1"><a class="docs-heading-anchor" href="#Sequencing:-*Core-concepts-and-basic-workflow*-1">Sequencing: <em>Core concepts &amp; basic workflow</em></a><a class="docs-heading-anchor-permalink" href="#Sequencing:-*Core-concepts-and-basic-workflow*-1" title="Permalink"></a></h1><p><code>Pseudoseq</code> abstracts DNA sequencing experiments as sampling processes, because this is what they are from a statistical point of view. Just as a quadrat placed at random on the forest floor provides a small sample of it&#39;s species composition, so it is that a sequencing read provides a small sample of the composition of the motifs present in a genome.</p><p>This manual includes several examples showing how to emulate various sequencing experiments using different technologies. But the core workflow, and important concepts are outlined below.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>The user can use Pseudoseq&#39;s API to script each stage of the flow outlined below themselves, or they can use the <a href="../../../api/sequence/#Pseudoseq.Sequencing.sequence"><code>sequence</code></a> function, which is the highest-level user facing function. Every example in this section of the manual, will show you how to use both options to achieve the same goal.</p></div></div><p>Anyway, the core sequencing workflow in Pseudoseq is as follows...</p><h2 id=".-Create-a-pool-of-DNA-molecules-1"><a class="docs-heading-anchor" href="#.-Create-a-pool-of-DNA-molecules-1">1. Create a pool of DNA molecules</a><a class="docs-heading-anchor-permalink" href="#.-Create-a-pool-of-DNA-molecules-1" title="Permalink"></a></h2><p>In reality, all DNA sequencing experiments begin with a sample of tissue or cells. DNA is extracted from the sample in the laboratory, after the genomes of the cells exist as number of DNA molecules, suspended in a solution.</p><p>In <code>Pseudoseq</code>, such a collection of DNA molecules is called <em>a molecule pool</em>, it is created with the <a href="../../../api/pool/#Pseudoseq.Sequencing.Molecules"><code>Molecules</code></a> constructor function.</p><p>In the beginning of a <code>Psueodseq</code> simulation script you create a pool that is the totality of all copies of the genome that exist in your simulation.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>You can think of the pool at this stage as containing many copies of the same genome sequence:</p><pre><code class="language-none">   1. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
   2. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
   3. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
                                ...
4999. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
5000. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC</code></pre></div></div><h2 id=".-Process-the-DNA-molecule-pool-1"><a class="docs-heading-anchor" href="#.-Process-the-DNA-molecule-pool-1">2. Process the DNA molecule pool</a><a class="docs-heading-anchor-permalink" href="#.-Process-the-DNA-molecule-pool-1" title="Permalink"></a></h2><p>You then subject your starting DNA molecule pool to a series of transformations, until the pool has the properties you want to emulate.</p><p>Here we will describe the different transformations you can apply to a DNA molecule pool:</p><h3 id="Fragmenting-the-pool-1"><a class="docs-heading-anchor" href="#Fragmenting-the-pool-1">Fragmenting the pool</a><a class="docs-heading-anchor-permalink" href="#Fragmenting-the-pool-1" title="Permalink"></a></h3><p>In an ideal world, if DNA sequencing machines could start at one end of a molecule and read the sequence all the way to the end with reasonable accuracy and throughput, you could simulate that by selecting molecules from your pool, and producing a read file. Give or take some inevitable errors (all detection equipment has a rate of error), assembling a genome would be simple.</p><p>Sadly, we don&#39;t have such an amazing sequencer technology that allows the reading of a chromosome in its entirety. Instead, shorter reads are taken of short fragments of DNA. Even long read technology uses fragments and produces reads, much shorter than the full size of a chromosome molecule.</p><p>A common step in any DNA sequencing experiment, therefore, is to fragment or shear the DNA molecules that are present in the pool.</p><p>This is achieved in <code>Pseudoseq</code> with the <a href="../../../api/pool/#Pseudoseq.Sequencing.fragment-Tuple{Molecules,Int64}"><code>fragment</code></a> function.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>You can visualise this process like so:</p><p>From:</p><pre><code class="language-none">   1. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
   2. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
   3. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
                                ...
4999. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC
5000. CGGACTTGAATAGCCCAAAGGTTTCGACACGATCACGACACATAAATTGGCGGACTTGAATAGC</code></pre><p>To:</p><pre><code class="language-none">   1. CGGACTT GAATAGC CCAAA GGTTTCGACACGA TCACGAC ACATAAAT TGGCGGAC TTGAATAGC
   2. CGGA CTTGAAT AGCCCAAAG GTTTCGAC ACGATCACGACACAT AAATTGGCGGA CTTGA ATAGC
   3. CGGACTTGA ATAGCC CAAAGGT TTCGACACGAT CACGACACA TAAATT GGCGGACTT GAATAGC
                                ...
4999. CGGAC TTGAATA GCCCAAAGGTTT CGACACGA TCACGACACAT AAATTG GCGGACTTG AATAGC
5000. CGGACTTGAA TAGCCCA AAGGTTTCGA CACGATCAC GACACA TAAATTGGCGG ACTTGAAT AGC</code></pre></div></div><h3 id="Subsampling-molecules-from-a-pool-1"><a class="docs-heading-anchor" href="#Subsampling-molecules-from-a-pool-1">Subsampling molecules from a pool</a><a class="docs-heading-anchor-permalink" href="#Subsampling-molecules-from-a-pool-1" title="Permalink"></a></h3><p>DNA sequencing experiments are sampling processes, not every one of the  DNA molecules in a pool will be read by the sequencer.</p><p>Randomly subsampling (without replacement) DNA molecules of a pool is achieved in <code>Pseudoseq</code> with the <a href="../../../api/pool/#Pseudoseq.Sequencing.subsample-Tuple{Molecules,Int64}"><code>subsample</code></a> function.</p><h4 id="Determining-the-number-of-molecules-to-subsample-1"><a class="docs-heading-anchor" href="#Determining-the-number-of-molecules-to-subsample-1">Determining the number of molecules to subsample</a><a class="docs-heading-anchor-permalink" href="#Determining-the-number-of-molecules-to-subsample-1" title="Permalink"></a></h4><p>You can estimate how often a base position in the genome is represented in a DNA molecule pool using the following formula.</p><div>\[C = \frac{LN}{G}\]</div><p>Where <span>$C$</span> is the expected coverage, <span>$L$</span> is the average length of the fragments, and <span>$N$</span> is the number of fragments, and <span>$G$</span> is the number of bases in the genome.</p><p>If you wanted to subsample a pool such that each base position in a genome is represented ~50 times (i.e. to achieve 50x coverage), you can determine the number of fragments to subsample from the universe, by reversing the formula:</p><div>\[N = \frac{CG}{L}\]</div><p>For example, if you wanted to sequence 250bp paired-end reads, at 50x coverage, with a genome size of 4639675bp:</p><div>\[\frac{50 \times 4639675}{250} = 927935\]</div><p>Remembering that you get two reads from one DNA molecule with paired-end sequencing, you know to subsample <span>$927935 / 2 = 463967$</span> DNA molecules from a pool.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>Pseudoseq provides a helper function that assists in this type of calculation:</p><pre><code class="language-julia">genome_size = 4639675
expected_coverage = 50
read_length = 250

N = needed_sample_size(expected_coverage, genome_size, readlength)

# Divide by 2 as we&#39;re doing paired end sequencing.
div(N, 2)</code></pre></div></div><h3 id="Tagging-molecules-in-a-pool-1"><a class="docs-heading-anchor" href="#Tagging-molecules-in-a-pool-1">Tagging molecules in a pool</a><a class="docs-heading-anchor-permalink" href="#Tagging-molecules-in-a-pool-1" title="Permalink"></a></h3><p>Some DNA sequencing technologies work by allowing short reads to contain longer range information by tagging molecules in a pool. The basic idea being that if two short reads come from the same large DNA molecule, they will have the same tag.</p><p>If a DNA fragment in a universe is tagged, and then it is subsequently fragmented during a <a href="../../../api/pool/#Pseudoseq.Sequencing.fragment-Tuple{Molecules,Int64}"><code>fragment</code></a> transform, then all the smaller fragments derived from that long fragment will inherit that long fragment&#39;s tag. This allows shorter fragments to possess longer range information in the form of these tags, and this is the basis of 10x sequencing and similar technologies.</p><p><code>Pseudoseq</code> lets you attach tags to molecules in a pool using the <a href="man/sequencing/@ref"><code>tag</code></a> function.</p><h2 id=".-Generating-reads-1"><a class="docs-heading-anchor" href="#.-Generating-reads-1">3. Generating reads</a><a class="docs-heading-anchor-permalink" href="#.-Generating-reads-1" title="Permalink"></a></h2><p>Next, you generate a set of reads from your transformed pool.  <code>Pseudoseq</code> allows you to create paired-end sequencing reads, single-end sequencing reads, and linked paired-end sequencing reads.</p><p>You create a set of reads using the <a href="../../../api/reads/#Pseudoseq.Sequencing.paired_reads"><code>paired_reads</code></a> or <a href="../../../api/reads/#Pseudoseq.Sequencing.unpaired_reads"><code>unpaired_reads</code></a> functions.</p><p>At this point in the process, the reads will be perfect. Generating perfect reads might be useful for some purposes, such as for education: illustrating  assembly processes initially without the complication of errors to aid comprehension. It might also be interesting to illustrate the action of a heuristic on data without errors cf. data that does have errors. </p><p>In reality, all sequencers have certain error profiles - certain genomic motifs can cause different technologies to fail in different ways, and the probability of errors can change over time, particularly if the sequencing process involves chemical reactions, or if synchronisation is important. Some Illumina sequencers, for example, are subject to what is known as the phase-problem.</p><p>So how do we create errors?</p><p>Pseudoseq currently supports errors in the form of single base pair substitutions.</p><p>The reads object contains a Dictionary of (<code>Integer</code> =&gt; <code>Vector{Substitution}</code>) pairs, where the integer is the (1 based) index of the read, and the vector of substitutions contains the substitutions that will be applied to the sequence of the read at read-file generation.</p><p>The substitution type Pseudoseq uses is very simple can can be created using a base position, nucleotide pair. For example <code>Substitution(51, DNA_A)</code> results in a subsitution which would replace base 51 of a read with an &#39;A&#39; nucleotide.</p><p>Whilst you could populate and edit this dictionary manually, doing it for every read would be tedious.</p><p>You can generate substitutions programmatically though using the <a href="../../../api/reads/#Pseudoseq.Sequencing.edit_substitutions"><code>edit_substitutions</code></a> method, which allows you to pass an anonymous function or &quot;functor type&quot;, which edits the substitutions for each read.</p><p>Pseudoseq provides some built in functions for use with <a href="../../../api/reads/#Pseudoseq.Sequencing.edit_substitutions"><code>edit_substitutions</code></a>, and more will be added over time. A list with links to their API documentation is provided here.</p><ol><li><a href="../../../api/reads/#Pseudoseq.Sequencing.FixedProbSubstitutions"><code>FixedProbSubstitutions</code></a></li><li><a href="../../../api/reads/#Pseudoseq.Sequencing.ClearSubstitutions"><code>ClearSubstitutions</code></a></li></ol><p>Please see the API docs for <a href="../../../api/reads/#Pseudoseq.Sequencing.edit_substitutions"><code>edit_substitutions</code></a> for details of the requirements for any functions passed to <a href="../../../api/reads/#Pseudoseq.Sequencing.edit_substitutions"><code>edit_substitutions</code></a>.</p><p>If you have any questions about how to model a particular error profile, please see the examples section of the documentation, and also don&#39;t hesitate to open a GitHub Issue describing your particular scenario.</p><p>Finally, you use your set of reads to <a href="../../../api/reads/#Pseudoseq.Sequencing.generate"><code>generate</code></a> either an interleaved FASTQ file, or two FASTQ files (one for R1 reads, and one for R2 reads).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../puzzlemaker/concepts/">« PuzzleMaker</a><a class="docs-footer-nextpage" href="../examples/pe-example/">Paired end reads »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 5 June 2020 14:03">Friday 5 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
